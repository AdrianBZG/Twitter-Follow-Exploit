/*
 * Copyright - Adrian Rodriguez Bazaga (GitHub: AdrianBZG)
 * Licensed under Apache 2.0
 */

package logic;

import org.openqa.selenium.By;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.firefox.FirefoxDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

import core.DataCache;
import core.TwitterData;
import core.UINamesData;
import randomfactory.HTTPRequestFactory;

public class Main {
  public static final String GECKO_DRIVER_PATH = "C:\\Users\\QiCanarias23\\Documents\\geckodriver.exe";
  public static String DEFAULT_USER_PASSWORD = "great123456789pass";

  public static void main(String[] args) {
    System.setProperty("webdriver.gecko.driver", GECKO_DRIVER_PATH);

    int randomNum = 0 + (int)(Math.random() * 3);
    DataCache.newUserCreated(HTTPRequestFactory.performRequestInBackground(UINamesData.QUERIES_BY_REGION.get(randomNum)));


    FirefoxDriver driver = new FirefoxDriver();
    driver.get(TwitterData.TWITTER_REG_URL);

    WebDriverWait wait = new WebDriverWait(driver, 10);
    WebElement element = wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("full-name")));

    driver.findElement(By.id("full-name")).sendKeys(DataCache.lastResponseObject.getName() + " " + DataCache.lastResponseObject.getSurname());
    driver.findElement(By.id("email")).sendKeys(DataCache.lastResponseObject.getEmail());
    try {
      Thread.sleep(1000);
    } catch (InterruptedException e1) {
      e1.printStackTrace();
    }
    driver.findElement(By.id("password")).sendKeys(DEFAULT_USER_PASSWORD);

    driver.findElement(By.id("submit_button")).click();

    try {
      Thread.sleep(1000);
    } catch (InterruptedException e) {
      e.printStackTrace();
    }

    driver.get(TwitterData.TWITTER_STEP2_REG_URL);

    WebElement element2 = wait.until(ExpectedConditions.visibilityOfElementLocated(By.id("username")));

    randomNum = 1 + (int)(Math.random() * 50);
    driver.findElement(By.id("username")).sendKeys(DataCache.lastResponseObject.getName().toLowerCase() + DataCache.lastResponseObject.getSurname().toLowerCase() + randomNum);

    driver.findElement(By.id("submit_button")).click();

    try {
      Thread.sleep(1000);
    } catch (InterruptedException e) {
      e.printStackTrace();
    }

    driver.get(TwitterData.TWITTER_BASE_URL + TwitterData.TWITTER_USER_TO_FOLLOW);

    WebElement element3 = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//li[contains(@class, 'follow-button')]/li[1]/a")));

    driver.findElement(By.xpath("//li[contains(@class, 'follow-button')]/li[1]/a")).click();

    try {
      Thread.sleep(1000);
    } catch (InterruptedException e) {
      e.printStackTrace();
    }

    //Tidy up now.
    driver.quit();

  }
}
